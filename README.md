# Payment Order System

The *Payment Order System* is a web-based application that allows users to place orders and process payments using the [Stripe](https://stripe.com/) payment gateway. This project demonstrates how to integrate payment processing with Laravel, handle webhooks, and ensure secure transactions.

## Table of Contents

- [Features](#features)
  - [Features Overview](#features-overview)
    - [API-based Order Management](#api-based-order-management)
    - [Stripe Payment Gateway Integration](#stripe-payment-gateway-integration)
    - [Testing Support](#testing-support)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
  - [Configuring Stripe Payment Gateway](#configuring-stripe-payment-gateway)
- [Testing](#testing)
  - [Running Tests](#running-tests)
- [API Documentation](#api-documentation)
  - [Postman Collection](#postman-collection)
  - [Endpoints Overview](#endpoints-overview)
- [Using Ngrok for Webhook Testing](#using-ngrok-for-webhook-testing)
- [Running the Project](#running-the-project)
- [Contributing](#contributing)
- [License](#license)
- [Acknowledgements](#acknowledgements)

## Features

### Features Overview

#### API-based Order Management

- Create, view, and list orders.
- Ensure users can only access their own orders.

#### Stripe Payment Gateway Integration

- Secure payment processing.
- Webhooks to handle payment status updates.

#### Testing Support

- PHPUnit and API tests.
- Coverage report for code testing completeness.

## Getting Started

### Prerequisites

Before you begin, ensure you have met the following requirements:

- *PHP* >= 8.2
- *Composer*
- *MySQL*
- *Ngrok* (for webhook testing)

### Installation

1. *Clone the repository:*

    ```bash
    git clone https://github.com/your-username/payment-order-system.git
    cd payment-order-system
    ```

2. *Install dependencies:*
  
    ```bash
    composer install
    ```

3. *Set up your database:*

    ```sql
    CREATE DATABASE payment_order_system;
    ```

4. *Run database migrations:*

    ```bash
    php artisan migrate
    ```

5. *Seed the database with sample data (optional):*

    ```bash
    php artisan db:seed
    ```

6. *Install frontend dependencies (if required):*

    ```bash
    npm install && npm run dev
    ```

7. *Copy the environment file:*

    ```bash
    cp .env.example .env
    ```

8. *Generate the application key:*

    ```bash
    php artisan key:generate
    ```

### Configuring Stripe Payment Gateway

1. *Create a Stripe Account:*

   Visit [Stripe](https://stripe.com/) and create an account.

2. *Obtain API Keys:*

   Navigate to *Developers > API Keys* in your Stripe dashboard and copy the *Publishable key* and *Secret key* into the .env file:

    env
    STRIPE_KEY=your-stripe-public-key
    STRIPE_SECRET=your-stripe-secret-key
    

3. *Webhook Setup:*

   - *Use Ngrok to expose your local environment:*

     ```bash
     ngrok http 8000
     ```

   - *Copy the ngrok public URL* (e.g., https://abc123.ngrok.io).

   - *In Stripe, configure the webhook:*

     ```bash
     https://abc123.ngrok.io/webhook/stripe
     ```

   - *You can trigger test events using the Stripe CLI:*

     ```bash
     stripe trigger payment_intent.succeeded
     ```

## Testing

This project includes unit and feature tests to ensure functionality.

### Running Tests

- *Run all tests:*

    ```bash
    php artisan test
    ```

- *Run PHPUnit with code coverage:*

    ```bash
    ./vendor/bin/phpunit --coverage-html coverage-report
    ```

- *View the coverage report:*

  Open coverage-report/index.html in your browser.

## API Documentation

### Postman Collection

The Postman collection is provided to simplify API testing.

1. *Import the Postman collection:*

   Open Postman, and use *Import > File* to import the postman-collection.json.

2. *Authentication:*

   Use *Bearer Token* for API requests.

   *Example:*

    ```http
    Authorization: Bearer <your-access-token>
    ```

### Postman Documentation

-[Postman Documentation](https://documenter.getpostman.com/view/15523725/2sAXxS8rUp) 

https://documenter.getpostman.com/view/15523725/2sAXxS8rUp

## Using Ngrok for Webhook Testing

To test Stripe webhooks locally, follow these steps:

1. *Install Ngrok:*

   Download and install Ngrok from [ngrok.com](https://ngrok.com/).

2. *Run Ngrok:*

    ```bash
    ngrok http 8000
    ```

3. *Configure Stripe Webhook:*

   Use the public URL generated by Ngrok (e.g., https://abc123.ngrok.io) and set it as the webhook URL in Stripe:

    ```bash
    https://abc123.ngrok.io/webhook/stripe
    ```

4. *Trigger Test Events:*

   Use the Stripe CLI to send events:

    ```bash
    stripe trigger payment_intent.succeeded
    ```

## Running the Project

1. *Start the Laravel development server:*

    ```bash
    php artisan serve
    ```

2. *Access the application:*

   Visit the following URL in your browser:

    ```http
    http://localhost:8000
    ```

